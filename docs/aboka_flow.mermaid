flowchart TB
    %% --- CONFIGURACI√ìN DE TEMA ---
    %% Theme variables for cleaner look
    
    %% --- ESTILOS ---
    classDef current fill:#e3f2fd,stroke:#1e88e5,stroke-width:3px,color:#0d47a1,font-weight:bold,rx:10,ry:10;
    classDef new_ai fill:#ffebee,stroke:#e53935,stroke-width:3px,color:#b71c1c,font-weight:bold,rx:20,ry:20;
    classDef existing_ai fill:#f5f5f5,stroke:#616161,stroke-width:2px,color:#212121,stroke-dasharray: 5 5,rx:5,ry:5;
    classDef decision fill:#fff9c4,stroke:#fbc02d,stroke-width:3px,color:#f57f17,rx:5,ry:5;
    classDef external fill:#ffffff,stroke:#fb8c00,stroke-width:3px,stroke-dasharray: 5 5,color:#ef6c00;

    %% --- LEYENDA ---
    subgraph Legend [" üó∫Ô∏è  LEYENDA "]
        direction LR
        L1[Proceso Manual Actual]:::current
        L2(Nueva IA / Automatizaci√≥n):::new_ai
        L3{{IA Core - Disponible}}:::existing_ai
    end

    %% --- IA CORE ---
    subgraph Core [" üß†  IA CORE (RAMA) "]
        direction LR
        C1{{üìß Email Docs}}:::existing_ai
        C2{{üß† RAG Analysis}}:::existing_ai
        C3{{‚è∞ Recordatorios}}:::existing_ai
        C4{{üéôÔ∏è Voz}}:::existing_ai
        C5{{üìä Dashboard Global}}:::existing_ai
    end

    %% --- FLUJO PRINCIPAL ---
    subgraph MainFlow [" üè¢  FLUJO DE NEGOCIO ABOKA "]
        direction TB
        
        %% PASO 1
        subgraph P1_Group [" 1. B√öSQUEDA "]
            direction TB
            Step1[üîç B√∫squeda Manual]:::current
            AI1(ü§ñ Scraper Idealista):::new_ai
            Step1 -.-> AI1
        end

        %% PASO 2
        subgraph P2_Group [" 2. COMPRA "]
            direction TB
            Step2[üí∞ Compra / Negociaci√≥n]:::current
            AI2a(üìÑ Proceso de Compra):::new_ai
            AI2b(üî¢ Calc Rentabilidad):::new_ai
            Step2 -.-> AI2a & AI2b
        end

        %% PASO 3
        subgraph P3_Group [" 3. REFORMA "]
            direction TB
            Step3[üõ†Ô∏è Gesti√≥n de Obra]:::current
            AI3a(‚úÖ Inspection Checklist):::new_ai
            AI3b(üìâ Control Presupuesto):::new_ai
            AI3c(üìú Contratos Auto):::new_ai
            AI3d(üë∑ Dashboard Personal):::new_ai
            Step3 -.-> AI3a & AI3b & AI3c & AI3d
        end

        %% DECISI√ìN
        Dec{‚öñÔ∏è ESTRATEGIA}:::decision

        %% PASO 4
        subgraph P4_Group [" 4. ALQUILER "]
            direction TB
            Step4[üè† Short-term Let]:::current
            AI4a(üìÖ Calendario Auto):::new_ai
            AI4b(üë• Gesti√≥n Hu√©spedes):::new_ai
            Step4 -.-> AI4a & AI4b
        end

        %% PASO 5
        subgraph P5_Group [" 5. VENTA "]
            direction TB
            Step5[ü§ù Venta Propiedad]:::current
            AI5a(üîç Checks Comprador):::new_ai
            AI5b(üìÇ Documentaci√≥n Venta):::new_ai
            Step5 -.-> AI5a & AI5b
        end

        %% CONEXIONES DE FLUJO
        P1_Group ==> P2_Group
        P2_Group ==> P3_Group
        P3_Group ==> Dec
        Dec ==>|Rentabilidad| P4_Group
        Dec ==>|Exit| P5_Group
    end

    %% --- PARTNER EXTERNO ---
    Ext[ü§ù INMUGA\nGesti√≥n Inmobiliaria]:::external

    %% --- CONEXIONES EXTERNAS Y CORE ---
    %% Partner
    Step2 <==> Ext
    Step5 <==> Ext

    %% Core Capabilities
    C1 -.- AI2a & AI5b
    C2 -.- AI1
    C3 -.- Step3
    C5 -.- Step4 & Step5

    %% Estilo de enlaces
    linkStyle default stroke:#78909c,stroke-width:2px,fill:none;
